<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comle.Maintenance">

	<resultMap
		type="com.lion.echart.project.entity.MaintenanceEntity"
		id="maintenance">
		<id property="maintenanceId" column="maintenanceid" />
		<result property="priority" column="priority" />
		<result property="entnyname" column="entnyname" />
		<result property="grade" column="grade" />
		<result property="perentId" column="perentid" />
		<result property="codeno" column="codeno" />
		<result property="unit" column="unit" />
		<result property="begindate" column="begindate" />
		<result property="planfinishdate" column="planfinishdate" />
		<result property="workload" column="workload" />


	</resultMap>
	<!-- 仅供分局填报查询列表使用 -->
	<select id="getMaintenanceListData"
		parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			maintenanceid,priority,entnyname,grade,perentid,`index`,codeno,unit,workload
			,begindate,planfinishdate
			,DATE_FORMAT(begindate,'%Y-%m-%d') as begindatestr
			,DATE_FORMAT(planfinishdate,'%Y-%m-%d') as planfinishdatestr
		FROM
		t_f_maintenance where 1 = 1
		<if test="maintenanceid != null">
		 and maintenanceid = #{maintenanceid} 
		</if>
		order by codeno
	</select>
	<insert id="insertMaintenance" parameterType="com.lion.echart.project.entity.MaintenanceEntity">
           insert into t_f_maintenance(priority,entnyname,grade,perentid,`index`,codeno,unit)  
               values(#{priority}, #{entnyname},#{grade},  #{perentid},  #{index},  #{codeno}, #{unit})
   	</insert>
   	
   	<select id="getSubMaxInxdexAo" parameterType="java.util.Map" resultType="java.lang.Integer" >
    	SELECT 
    	ifnull(MAX(t.index),0)+1 
    	FROM t_f_maintenance t 
    	WHERE t.perentid = #{maintenanceid}
   	</select>
   		<select id="getSubMaxGradeAo" parameterType="java.util.Map" resultType="java.lang.String" >
    	SELECT 
    	ifnull(MAX(t.index),0)+1 
    	FROM t_f_maintenance t 
    	WHERE t.grade = #{grade}
   	</select>
   	
   	<!-- 查找一级 -->
	 <select id="getstairsubofficeGet" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
		maintenanceid,priority,entnyname,grade,perentid,`index`,codeno,unit
		FROM
		t_f_maintenance where 1 = 1
		<if test="grade != null">
		 and grade = #{grade}
		</if>
		
		<if test="perentid != null">
		 and perentid = #{perentid} 
		</if>
		<if test="maintenanceid != null">
		 and maintenanceid = #{maintenanceid} 
		</if>
		order by codeno
	</select> 
</mapper>